<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Prueba Escaneo</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="p-4">

<h3>Informe de Recepción de Ejemplo</h3>

<form id="formScan" onsubmit="return false;">
  <input id="codigoBarra" class="form-control w-25" placeholder="Escaneá el producto" required>
  <br>
</form>

<table class="table">
  <thead>
    <tr>
      <th>Producto</th>
      <th>Código</th>
      <th>Cantidad</th>
      <th>Recibidos</th>
      <th>Estado</th>
    </tr>
  </thead>
  <tbody id="tablaProductos">
    <tr data-codigo="abc123">
      <td>Yerba</td>
      <td>abc123</td>
      <td>10</td>
      <td class="recibidos">0</td>
      <td class="estado">Pendiente</td>
    </tr>
    <tr data-codigo="xyz789">
      <td>Fideos</td>
      <td>xyz789</td>
      <td>5</td>
      <td class="recibidos">0</td>
      <td class="estado">Pendiente</td>
    </tr>
  </tbody>
</table>

<button id="confirmarBtn" class="btn btn-success" disabled>Confirmar Recepción</button>

<script>
  const inputCodigo = document.getElementById('codigoBarra');
  const confirmarBtn = document.getElementById('confirmarBtn');

  inputCodigo.addEventListener('keydown', function (e) {
    if (e.key === 'Enter') {
      e.preventDefault();

      const codigo = this.value.trim().toLowerCase();
      if (!codigo) return alert('Ingrese un código válido');

      console.log('Código escaneado:', codigo);

      const fila = Array.from(document.querySelectorAll('tr[data-codigo]'))
        .find(tr => tr.getAttribute('data-codigo').toLowerCase() === codigo);
        
      alert(document.querySelectorAll('tr[data-codigo]'));

      if (!fila) {
        alert('Código no encontrado en esta factura');
        this.value = '';
        return;
      }

      let cantidadRecibida = prompt(`Ingrese cantidad recibida para ${fila.children[0].textContent}:`, '1');
      cantidadRecibida = parseInt(cantidadRecibida);
      if (isNaN(cantidadRecibida) || cantidadRecibida <= 0) {
        alert('Cantidad inválida');
        this.value = '';
        return;
      }

      const tdRecibidos = fila.querySelector('.recibidos');
      tdRecibidos.textContent = cantidadRecibida;

      const cantidadEsperada = parseInt(fila.children[2].textContent); // Columna Cantidad
      const tdEstado = fila.querySelector('.estado');

      if (cantidadRecibida > cantidadEsperada) {
      tdEstado.textContent = 'Sobrantes';
       } else if (cantidadRecibida === cantidadEsperada) {
      tdEstado.textContent = 'Completado';
        } else {
      tdEstado.textContent = 'Pendiente';
        }

      confirmarBtn.disabled = false;
      this.value = '';
    }
  });

  confirmarBtn.addEventListener('click', () => {
    alert('Recepción confirmada (simulado)');
  });

  // Para debug: ver todos los códigos en consola
  document.querySelectorAll('tr[data-codigo]').forEach(tr => {
    console.log('Código en tabla:', tr.getAttribute('data-codigo'));
  });
</script>

</body>
</html>
