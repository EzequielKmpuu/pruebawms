<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Productos</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/estilos.css">
</head>
<body class="p-4">
  
  <h3>Reubicar Productos Ingresados</h3><br>
  <h2 class="text-center text-bg-danger p-3 rounded">ESTA SECCION DE MOMENTO NO FUNCIONA</h2>

    <input class="form-control" style="width: 300px;" type="text" id="codigoBusqueda" placeholder="Escanear o ingresar c贸digo de barras" autofocus /><br>
    <div id="infoProducto"></div>
    <div id="infoUbicacion"></div><br>
    <input class="form-control" style="width: 300px;" type="text" id="nuevaUbicacion" placeholder="Nueva ubicaci贸n" />
    <button class="btn btn-success mt-3" style="width: 300px;" id="btnReubicar">Reubicar</button><br>
    <br>

    <table class="table table-bordered table-sm">
    <thead class="table-light">
      <tr>
        <th>ID</th><th>Ubicaciones</th>
      </tr>
    </thead>
    <tbody>
      <% ubicaciones.forEach(ub => { %>
        <tr>
            <td><%= ub.id %></td>
            <td><input name="ubicacion" value="<%= ub.ubicacion.toUpperCase() %>" class="form-control form-control-sm" readonly></td>
        </tr>
      <% }) %>
    </tbody>
  </table>


<script>
  document.addEventListener('DOMContentLoaded', () => {
  const inputCodigo = document.getElementById('codigoBusqueda');
  const inputUbicacion = document.getElementById('nuevaUbicacion');
  const btnReubicar = document.getElementById('btnReubicar');

  if (!inputCodigo || !inputUbicacion || !btnReubicar) return;

  inputCodigo.addEventListener('keydown', async (e) => {
    if (e.key === 'Enter') {
      const codigo = e.target.value.trim();
      if (!codigo) return;

      const res = await fetch(`/reubicar/buscar/${codigo}`);
      const data = await res.json();

      if (data.error) {
        document.getElementById('infoProducto').innerText = 'Producto no encontrado';
        document.getElementById('infoUbicacion').innerText = 'Ubicaci贸n Inexistente';
      } else {
        document.getElementById('infoProducto').innerText = `Producto: ${data.nombre.toUpperCase()}`;
        document.getElementById('infoUbicacion').innerText = `Ubicaci贸n: ${data.ubicacion.toUpperCase()}`;
        inputCodigo.dataset.idProducto = data.id;
      }
    }
  });

  btnReubicar.addEventListener('click', async () => {
    const id = inputCodigo.dataset.idProducto;
    const nuevaUbicacion = inputUbicacion.value.trim();
    if (!id || !nuevaUbicacion) return alert('Complete todos los campos');

    const res = await fetch('/reubicar/validar', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ id, nuevaUbicacion })
    });

    const data = await res.json();
    alert(data.success ? 'Reubicado correctamente' : 'Error al reubicar');
    inputCodigo.value = '';
    inputCodigo.dataset.idProducto = '';
    inputUbicacion.value = '';
    document.getElementById('infoProducto').innerText = '';
    document.getElementById('infoUbicacion').innerText = '';
    inputCodigo.focus();
  });
});

</script>
<br>

  <a href="/dashboard" class="btn btn-secondary mt-3">Volver al dashboard</a>
</body>
</html>
